$(function(){$("input.clipboard").on("click",function(){this.select()});$(".download-all").click(function(event){event.preventDefault();var action=$(this).attr("href");$(this).closest("form").attr("action",action).submit()});$("#check_pay").on("submit",function(event){$(".right").html("");var link=$(this).attr("action");$.post(link,$(this).serialize(),function(json){if(json.ok){yaCounter23211493.reachGoal("SHOP_PAYED");window.location.href="/shops/"}else if(json.errors.global){$(".right").html('<div class="error">'+json.errors.global+"</div>")}},"json");event.preventDefault()});$(".downloadN").on("click",function(){var count=parseInt(prompt(deerMessages["0"]));if(count>0){window.location.href=this.href+count+"/?rnd="+Math.floor(Math.random()*99999999999)}return false});$(document).on("click","#select_all",function(){var checkboxes=$(this).closest("form").find(":checkbox").not($(this));if($(this).is(":checked")){checkboxes.prop("checked","checked")}else{checkboxes.prop("checked",false)}});$(document).on("click",".check_order",function(event){var link=$(this).attr("href");if(typeof csrf_token!=="undefined"){link+="?csrf_token="+csrf_token}$.post(link,{},function(json){if(json.ok){alert(json.url)}else if(json.errors){alert(json.errors.global)}csrf_token=json.csrf},"json");event.preventDefault()});$(document).on("click","#separator_add",function(event){var separator=prompt(deerMessages[1]);var cid=$(this).attr("data-cat");$.post($(this).attr("href"),{name:separator,cat:cid},function(json){if(json.name){$("#sortable tbody").append('<tr id="position_separator'+json.id+'" class="warning"><td class="text-valign"><input type="checkbox" name="sids[]" value="'+json.id+'" /></td><td  colspan="10" class="text-center text-valign">'+json.name+'</td><td class="text-center text-valign"><a href="'+json.url+'separator/remove/" data-id="'+json.id+'" class="remove_separator"><i class="fa fa-remove"></i></a></td></tr>')}else if(json.errors){console.log(json.errors)}},"json");event.preventDefault()});$(document).on("click",".remove_separator",function(event){var id=$(this).attr("data-id");$.post($(this).attr("href"),{id:id},function(json){if(json.ok){$("#position_separator"+id).remove()}},"json");event.preventDefault()});$(document).on("change","#form-feedback select[name=type]",function(event){if($(this).val()==4)$(".feedback-claim").show();else $(".feedback-claim").hide();event.preventDefault()});$(document).on("change",".report-form select[name=status]",function(event){$(this).closest("form").submit()});if($("section.adv-page").size()>0){$('input[name="color"]').bind("change",function(){var price=getPrice()+50;$(".adsum").text(price+" руб.")});$('select[name="period"]').on("change",function(){$(".adsum").text(getPrice()+" руб.")});$(".adsum").text(getPrice()+" руб.");function getPrice(){var type=$('input[name="type"]').val(),period=$('select[name="period"]').val(),page=$('input[name="page"]').val(),where=$('input[name="where"]').val();if(period==undefined){period=1}return parseInt($(".adsum").attr("data-price"))*parseInt(period)}}var url=window.location.hash;if(url.match("#")){var el=$("#"+url.split("#")[1]);if(el.size()>0&&el.hasClass("collapse")){$("#"+url.split("#")[1]).addClass("in").css("height","auto")}}function fix_height(){var heightWithoutNavbar=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",heightWithoutNavbar+"px");var navbarHeigh=$("nav.navbar-default").height();var wrapperHeigh=$("#page-wrapper").height();if(navbarHeigh>wrapperHeigh){$("#page-wrapper").css("min-height",navbarHeigh+"px")}if(navbarHeigh<wrapperHeigh){$("#page-wrapper").css("min-height",$(window).height()+"px")}}fix_height();$("#selectPay").on("click",function(){$(".pay-choose").fadeIn(300)});$(".pay-choose").each(function(){var $this=$(this);$(document).mouseup(function(e){var div=$this;if(!div.is(e.target)&&div.has(e.target).length===0){$this.fadeOut(300)}})});$(".pay-choose input").on("click",function(){$("#selectPay").val($.trim($('input[type="radio"]:checked').closest(".pay-item").find(".pay-item__title").text()));$("#selectPayValue").val($('input[type="radio"]:checked').val());$("#selectGateway").val($('input[type="radio"]:checked').attr("data-gateway"));$(".pay-choose").fadeOut(300)});var tmt=null;$(".check-email").on("input",'input[name="email"]',function(e){var email=$('input[name="email"]').val();var a=$(".confirm-email");a.attr("href","/subscribe/email/send/"+"?email="+email);if(tmt!==null){clearTimeout(tmt)}tmt=setTimeout(function(){$.post("/subscribe/email/check",{email:email},function(data){if(!data.error){$(".check-email .error-email").hide();a.show()}if(data.result){$(".check-email .info-email").hide();a.hide()}else{$(".check-email .info-email").show();a.show()}if(data.error){$(".check-email .error-email").text(data.error);$(".check-email .error-email").show();a.hide()}},"json")},1e3)});$(".generate-discount-code").on("click",function(event){var link=$(this);$.post(link.attr("href"),{},function(data){if(data){link.closest(".form-group").find("input").val(data)}},"json");return false});if($(".stats-block").length){$.ajax({type:"GET",url:$("#yandex-metrika").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#yandex-metrika").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#popular-goods").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#popular-goods").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#earned").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#earned").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#yandex-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#yandex-balance").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#webmoney-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#webmoney-balance").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#qiwi-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#qiwi-balance").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#freekassa-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#freekassa-balance").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#unitpay-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#unitpay-balance").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#enotio-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#enotio-balance").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#lava-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#lava-balance").find(".card-body").html(data)}});$.ajax({type:"GET",url:$("#payeer-balance").attr("data-href"),data:{},beforeSend:function(){},success:function(data){$("#payeer-balance").find(".card-body").html(data)}})}$('#stats-config input[type="checkbox"]').on("change",function(e){var data=$(this).closest("form").serialize();$.ajax({type:"POST",url:$(this).closest("form").attr("action"),data:data,beforeSend:function(){},success:function(){}})});$("#freekassa_site").on("change",function(e){$(this).closest("form").find("#freekassa_api_token").closest(".form-group").hide();if($(this).val()==2){$(this).closest("form").find("#freekassa_api_token").closest(".form-group").show()}});$('#stats-config input[type="number"]').on("input",function(e){var data=$(this).closest("form").serialize();$.ajax({type:"POST",url:$(this).closest("form").attr("action"),data:data,dataType:"json",beforeSend:function(){},success:function(){},error:function(){}})});$(document).on("click","a.buy, .good-container",function(e){isiShop.variables.currency=$("select[name=paymethod]").val();var $popup=$(".choose_popup");var tr=$(this).parents("tr"),dData=$(this);if(tr.length>0){data=tr.data()}else{data=dData.data()}$(".order_popup").remove();$("#order").show();$("body").addClass("popup-open");$.each(data,function(i,elem){isiShop.variables["good_"+i]=elem});isiShop.variables.discountPercent=0;$popup.find("#good_title").text(data.title);$popup.find("#good_count").val(data.mincount);$popup.find("#discount_code").val("");$(".choose_popup #sum").text(isiShop.generateSum(data.mincount));$("#overlay, .choose_popup").fadeIn("slow");if(isiShop.variables.storage.getItem("lastorder")!=null){$("#btn-window").show()}var str=$("#sum").text();var sum=+str;$(".pay-item").show();$(".pay-item").each(function(k,val){if(sum<$(val).attr("data-min")&&$(val).attr("data-min")!==""){$(this).hide()}if(sum>$(val).attr("data-max")&&$(val).attr("data-max")!==""){$(this).hide()}});return false});$("#redirect-prolongation").change(function(){$.post($(this).attr("data-href"),"",function(data){},"json")});$("table.goods").on("click",".copy-good",function(e){e.preventDefault();var el=$(this);$.ajax({type:"POST",url:$(this).attr("href"),dataType:"json",success:function(res){el.closest("tr").after(res)},error:function(){}})})});